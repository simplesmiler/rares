#!/usr/bin/env node

module.exports = async function() {
  const Hapi = require('hapi');

  const server = new Hapi.Server({
    host: process.env.HOST || 'localhost',
    port: process.env.PORT || 3000,

    // debug: { request: ['error'] },
  });

  await server.register([
    require('..'),
  ]);

  console.log(`Starting the server...`);
  await server.start();
  console.log(`Server running at: ${server.info.uri}`);

  await new Promise(resolve => process.on('SIGINT', resolve));

  console.log(`Stopping the server...`);
  await server.stop({ timeout: 10000 });
  console.log(`Server stopped`);

  return server;
};
