#!/usr/bin/env node

module.exports = async function(argv) {
  const Rares = require('..');

  const backend = argv.server || 'hapi';
  let server = null;
  if (backend === 'hapi') {
    server = await require('hapi-rares/server')(null, Rares);
  }
  else if (backend === 'express') {
    server = await require('express-rares/server')(null, Rares);
  }
  else {
    throw new Error(`Unsupported server ${backend}`);
  }

  console.log(`Starting the server...`);
  await server.start();
  console.log(`Server running at: ${server.uri}`);

  await new Promise(resolve => process.on('SIGINT', resolve));

  console.log(`Stopping the server...`);
  await server.stop();
  console.log(`Server stopped`);

  await server.cleanup();

  return true;
};
